// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Feed {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId

  sourceUrl    String   @unique
  meta         Json
  items        Json
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("feeds")
}

model User {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  email        String   @unique
  passwordHash String
  name         String? // optional
  role         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("users")
}

model Session {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  token     String   @unique // 32B base64url (43â€“44 symbols without '=')
  userId    String   @unique @db.ObjectId
  createdAt DateTime @default(now())
  expiresAt DateTime

  @@map("sessions")
}

model Creative {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  url          String
  type         AdType   // Changed from String on AdType
  width        Int
  height       Int
  mime         String
  bytes        Int
  originalName String?
  createdAt    DateTime @default(now())

  lineItems    LineItem[]

  @@map("creatives")
}

model LineItem {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  size        String
  cpmMin      Float
  cpmMax      Float
  geo         String[]
  adType      AdType   @default(banner)  // Changed from String on AdType
  frequency   Int      @default(1)
  interval    String   @default("hour")
  status      Status   @default(active)  // Changed from String on Status
  creativeId  String   @db.ObjectId
  creative    Creative @relation(fields: [creativeId], references: [id])
  createdAt   DateTime @default(now())

  @@index([status])
  @@index([geo])
  @@index([status, cpmMin, cpmMax])
  @@map("line_items")
}


model ImpressionLog {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  lineItemId  String   @db.ObjectId
  userIp      String
  timestamp   DateTime @default(now())

  @@index([lineItemId, userIp, timestamp])
}

enum AdType {
  banner
  video
  native
}

enum Status {
  active
  inactive
  paused
}